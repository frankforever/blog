# **数据库系统原理**

## **第二章**

数据模型是一个包含数据、数据联系、数据语义以及一致性约束的概念工具的合集。

数据模型包括：

关系模型、实体-联系模型（E-R）、基于对象的数据模型、半结构化数据模型。

关系模式属于中，关系指代表，元组指代行，属性指代列。

对于关系的每个属性，都存在一个取值集合，称为属性的域。

超码是一个或多个属性的集合，可以在关系中唯一标识一个元组。

候选码

主码

## **第三章**

nvarchar数据类型，unicode编码可变长度类型，最大值4000，支持多语言。

SQL禁止破坏完整性约上的任意数据库更新。

```sql
drop table r;    --删除关系r
delete table r;  --删除关系r的所有元组，但是关系r保留

select distinct name 
from instructor;  --去除重复查询结果
```

**自然连接**

```sql
select name, course_id
from instructor, teaches
where instructor.ID = teachers.ID;
用自然连接简写为：
select name, course_id
from instructor natural join teaches;
```

join···using···用法

```sql
select name, title
from instructor natural join teaches, course
where teaches.course_id = course.course_id;
等价于
select name, title
from (instructor natural join teaches) join course using (course_id);
```

更名运算 `as`, Oracle中可省略。

相关名称

SQL标准中字符串相等运算大小写敏感，在MySQL和SQL server中大小写不敏感。

字符串上可以使用 `like`操作符来实现模式匹配。`%`：匹配任意字符，`_`：匹配任意一个字符。

可使用 `escape` 关键字来定义转义字符。

```sql
select dept_name
from department
where building like '%ab\%\\cd%' escape '\' ;
--选取以ab%\cd为开头的名字
```

`*` 表示所有属性。

```sql
select instructor.*
from instructor as I, teaches as T
where I.id = T.id;
```

`oder by`定义显示次序，`dsec` 表示降序， `sec` 表示升序。

```sql
select *
from instructor
order by salary dsec, name sec;
```

```sql
select name
from instructor
where salary between 9000 and 10000;
```

```sql
select name, course_id
from instructor, teaches
where (instructor.ID, dept_name) = (teaches.ID, 'Biology');
```

`union`（并）运算自动去重复：(`union all`可保留左右重复元组)

```sql
(select course_id
 from section 
 where semester = 'Fall' and year = 2009)
 union
(select course_id
 from section
 where semester = 'Spring' and year = 2010);
```

`intersect`（交）运算也自动去重复，`intersect all`同上

`except`（差）运算，第一个减第二个，运算前去重复。`except all`同上。

如果算术表达式的任一输入为空，则结果为空。

unknow为第三种逻辑。

```sql
and: true and unknow:true, false and unknow: unknow, unknow and unknow: unknow
or: true or unknow : true, false or unknow : unknow, unknow or unknow:unknow
not: not unknow : unknow
```

谓词中 `null = null` 会返回`unknow`

**聚集函数**

```sql
--包含avg, sum, count, min, max
select avg(salary) as avg_salary
from instructor
where dept_name = 'Comp.Sci.';    --保留重复元组很重要
--去重复元组情况：
select count(distinct ID)
from teaches
where semester = 'Spring' and year = 2010;
--计算一个关系中的元组数：
select count(*)
from course;
--分组聚集使用group by
select dept_name, avg(salary) as avg_salary
from instructor
group by dept_name;
--having子句可对分组进行约束
select dept_name, avg(salary) as avg_salary
from instructor
group by dept_name
having avg_salary > 42000;
```

空集的count运算为0，其他聚集运算输入空集后返回空集。

至少比某一个大用 `>some`表示（`any`同义与`some`），还有

`<some, >=some, <=some, <>some, =some`

比所有都大用`>all`表示，还有

`<all, >=all, <=all, =all, <>all`

比较一组查询方法，相同结果：

```sql
select distince course_id
from section
where semester = 'Fall' and year = 2009 and
	course_id in(select course_id
                  from section
                  where semester = 'Spring' and year = 2010);
                  
selecct course_id
from section as S
where semester = 'Fall' and year = 2009 and
	exists (select *
             from section as T
             where semester = 'Spring' and year = 2010 and 
           		S.course_id = T.course_id);
```

`not exists`结构模拟包含操作， `not exists(B except A)`即关系A包含关系B

布尔函数`unique`可用于测试一个子查询中是否存在重复元组，若无，返回真值。

`with`子句可定义临时关系。

## **第四章 中级SQL**

join on

```sql
select*
from student join takes on student.ID = takes.ID;
同
select*
from student natural join takes;
同
select*
from student, takes
where student.ID = takes.ID;
```

外连接

```sql
select*
from student natural left outer join takes;
同
select*
from takes natural right outer join sturent;
```

